import{a as m}from"./chunk-U5YLW2ZZ.js";import{a as q}from"./chunk-X3M3N6ZJ.js";import{e as H,g as B}from"./chunk-RFCIZRZT.js";import{f as O}from"./chunk-5LHHFRH4.js";import{$b as h,Ab as V,Cb as c,Db as $,E as U,Fa as y,Fb as z,Gb as A,Gc as F,Hb as s,I as k,Ib as o,Kb as P,Ob as M,Pb as d,Z as x,Za as a,Zb as r,a as I,aa as _,b as T,ea as D,ib as g,ja as C,l as E,nb as S,r as f,v as j,va as u,wa as b,yb as L,zb as N}from"./chunk-LZBM4COA.js";function W(i,t){i&1&&(s(0,"span",3),r(1," Predeterminado "),o())}function X(i,t){if(i&1&&(s(0,"p",5)(1,"span",9),r(2,"Tarjeta:"),o(),r(3),o()),i&2){let e=d();a(3),h(" **** **** **** ",e.paymentMethod.cardNumber.slice(-4)," ")}}function Y(i,t){if(i&1&&(s(0,"p",5)(1,"span",9),r(2,"Titular:"),o(),r(3),o()),i&2){let e=d();a(3),h(" ",e.paymentMethod.cardHolderName," ")}}function Z(i,t){if(i&1&&(s(0,"p",5)(1,"span",9),r(2,"Vencimiento:"),o(),r(3),o()),i&2){let e=d();a(3),h(" ",e.paymentMethod.expiryDate," ")}}function ee(i,t){if(i&1&&(s(0,"p",5)(1,"span",9),r(2,"Email:"),o(),r(3),o()),i&2){let e=d();a(3),h(" ",e.paymentMethod.paypalEmail," ")}}function te(i,t){if(i&1&&(s(0,"p",5)(1,"span",9),r(2,"Banco:"),o(),r(3),o()),i&2){let e=d();a(3),h(" ",e.paymentMethod.bankName," ")}}function ne(i,t){if(i&1&&(s(0,"p",5)(1,"span",9),r(2,"Cuenta:"),o(),r(3),o()),i&2){let e=d();a(3),h(" **** ",e.paymentMethod.accountNumber.slice(-4)," ")}}function ie(i,t){if(i&1){let e=P();s(0,"div",8)(1,"button",10),M("click",function(l){u(e);let p=d();return b(p.onSelectEdit(l))}),r(2," Editar "),o(),s(3,"button",11),M("click",function(l){u(e);let p=d();return b(p.onSelectDelete(l))}),r(4," Eliminar "),o()()}}var v=class i{paymentMethod;isEditable=!1;isSelectable=!1;isSelected=!1;edit=new y;delete=new y;select=new y;onSelectEdit(t){t.stopPropagation(),this.edit.emit(this.paymentMethod)}onSelectDelete(t){t.stopPropagation(),this.delete.emit(this.paymentMethod._id)}onCardClick(){this.isSelectable&&this.select.emit(this.paymentMethod._id)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=g({type:i,selectors:[["app-payment-methods-card"]],inputs:{paymentMethod:"paymentMethod",isEditable:"isEditable",isSelectable:"isSelectable",isSelected:"isSelected"},outputs:{edit:"edit",delete:"delete",select:"select"},decls:16,vars:20,consts:[[1,"bg-white","rounded-lg","shadow-md","p-4","transition-all","duration-300","relative",3,"click"],[1,"flex","justify-between","items-start","mb-3"],[1,"text-lg","font-semibold","text-gray-800","capitalize"],[1,"bg-blue-100","text-blue-800","text-xs","font-medium","px-2.5","py-0.5","rounded"],[1,"space-y-2","mb-4"],[1,"text-sm","text-gray-600"],[1,"mb-4"],[1,"text-xs","font-medium","px-2.5","py-0.5","rounded"],[1,"flex","gap-2","flex-wrap"],[1,"font-medium"],[1,"flex-1","bg-blue-500","hover:bg-blue-600","text-white","text-sm","font-medium","py-2","px-4","rounded","transition-colors","duration-200",3,"click"],[1,"flex-1","bg-red-500","hover:bg-red-600","text-white","text-sm","font-medium","py-2","px-4","rounded","transition-colors","duration-200",3,"click"]],template:function(e,n){e&1&&(s(0,"div",0),M("click",function(){return n.onCardClick()}),s(1,"div",1)(2,"h3",2),r(3),o(),S(4,W,2,0,"span",3),o(),s(5,"div",4),S(6,X,4,1,"p",5)(7,Y,4,1,"p",5)(8,Z,4,1,"p",5)(9,ee,4,1,"p",5)(10,te,4,1,"p",5)(11,ne,4,1,"p",5),o(),s(12,"div",6)(13,"span",7),r(14),o()(),S(15,ie,5,0,"div",8),o()),e&2&&(N("hover:shadow-lg",!0)("cursor-pointer",n.isSelectable)("ring-2",n.isSelected)("ring-blue-500",n.isSelected),a(3),h(" ",n.paymentMethod.type.replace("_"," ")," "),a(),c(n.paymentMethod.isDefault?4:-1),a(2),c(n.paymentMethod.cardNumber?6:-1),a(),c(n.paymentMethod.cardHolderName?7:-1),a(),c(n.paymentMethod.expiryDate?8:-1),a(),c(n.paymentMethod.paypalEmail?9:-1),a(),c(n.paymentMethod.bankName?10:-1),a(),c(n.paymentMethod.accountNumber?11:-1),a(2),V(n.paymentMethod.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),a(),h(" ",n.paymentMethod.isActive?"Activo":"Inactivo"," "),a(),c(n.isEditable?15:-1))},encapsulation:2})};function oe(i,t){if(i&1){let e=P();s(0,"app-payment-methods-card",2),M("edit",function(l){u(e);let p=d();return b(p.onEdit(l))})("delete",function(l){u(e);let p=d();return b(p.onDelete(l))})("select",function(l){u(e);let p=d();return b(p.onSelect(l))}),o()}if(i&2){let e=t.$implicit,n=d();L("paymentMethod",e)("isEditable",n.isEditable)("isSelectable",n.isSelectable)("isSelected",n.selectedId===e._id)}}var R=class i{paymentMethods=[];isEditable=!1;isSelectable=!1;selectedId=null;edit=new y;delete=new y;select=new y;onEdit(t){this.edit.emit(t)}onDelete(t){this.delete.emit(t)}onSelect(t){this.select.emit(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=g({type:i,selectors:[["app-payment-methods-list"]],inputs:{paymentMethods:"paymentMethods",isEditable:"isEditable",isSelectable:"isSelectable",selectedId:"selectedId"},outputs:{edit:"edit",delete:"delete",select:"select"},decls:3,vars:0,consts:[[1,"grid","gap-4"],[3,"paymentMethod","isEditable","isSelectable","isSelected"],[3,"edit","delete","select","paymentMethod","isEditable","isSelectable","isSelected"]],template:function(e,n){e&1&&(s(0,"div",0),z(1,oe,1,4,"app-payment-methods-card",1,$),o()),e&2&&(a(),A(n.paymentMethods))},dependencies:[v],encapsulation:2})};var ae=m.enum(["credit_card","debit_card","paypal","bank_transfer","cash_on_delivery"]),w=m.object({_id:m.string().min(1,"El ID es requerido"),type:ae,cardNumber:m.string().optional().nullable(),cardHolderName:m.string().optional().nullable(),expiryDate:m.string().optional().nullable(),paypalEmail:m.string().optional().nullable(),bankName:m.string().optional(),accountNumber:m.string().optional().nullable(),isDefault:m.boolean(),isActive:m.boolean()}),G=m.array(w),fe=w.omit({_id:!0}),xe=w.partial().required({_id:!0});var J=class i{constructor(t,e,n){this.http=t;this.store=e;this.toast=n;this.loadPayMethods()}baseUrl=`${q.BACK_URL}/payment-methods`;paymetMethodSubject=new E(null);paymetMethodListSubject=new E([]);paymetMethod$=this.paymetMethodSubject.asObservable();paymetMethods$=this.paymetMethodListSubject.asObservable();getUserId(){let t="";return this.store.select(H).pipe(k(1)).subscribe(e=>t=e??""),t}loadPayMethods(){let t=this.getUserId();if(console.log("Loading payment methods for user ID:",t),!t){console.log("No user ID found, setting empty array"),this.paymetMethodListSubject.next([]);return}this.getPayMethodbyUser(t).subscribe({next:e=>{console.log("Payment methods loaded:",e),this.paymetMethodListSubject.next(e)},error:e=>{console.error("Error loading payment methods:",e),this.paymetMethodListSubject.next([])}})}getPayMethodbyUser(t){return this.http.get(`${this.baseUrl}/user/${t}`).pipe(j(e=>{console.log(e);let n=G.safeParse(e);return n.success?n.data:(console.log(n.error),[])}))}addPaymentMethod(t){let e=this.getUserId();if(!e)return f([]);let n=T(I({},t),{user:e});return this.http.post(`${this.baseUrl}`,n).pipe(x(()=>this.getPayMethodbyUser(e)),_(l=>{this.toast.success("metodo de pago agregado"),this.paymetMethodListSubject.next(l)}))}editPaymentMethod(t){let e=this.getUserId();return e?this.http.put(`${this.baseUrl}/${t._id}`,t).pipe(x(()=>this.getPayMethodbyUser(e)),_(n=>{this.toast.success("metodo de pago actualizado"),this.paymetMethodListSubject.next(n)})):f([])}deletePaymentMethod(t){let e=this.getUserId();return e?this.http.delete(`${this.baseUrl}/${t}`).pipe(x(()=>this.getPayMethodbyUser(e)),_(n=>{this.toast.success("metodo pago eliminado"),this.paymetMethodListSubject.next(n??[])}),U(n=>(console.error("Error deleting payment method:",n),this.paymetMethodListSubject.next([]),f([])))):f([])}static \u0275fac=function(e){return new(e||i)(C(F),C(O),C(B))};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})};export{R as a,J as b};
