import{a as l}from"./chunk-U5YLW2ZZ.js";import{a as O}from"./chunk-X3M3N6ZJ.js";import{e as P,g as B}from"./chunk-RFCIZRZT.js";import{f as F}from"./chunk-5LHHFRH4.js";import{$b as g,Cb as h,Db as $,Fa as m,Fb as k,Gb as V,Gc as z,Hb as o,I as U,Ib as n,Kb as E,Ob as f,Pb as a,Z as _,Za as p,Zb as r,aa as C,c as I,ea as D,ib as A,ja as b,l as w,nb as v,r as x,v as T,va as u,wa as S,yb as j,zb as L}from"./chunk-LZBM4COA.js";function G(i,t){i&1&&(o(0,"span",3),r(1," Predeterminado "),n())}function J(i,t){if(i&1&&(o(0,"p",5)(1,"span",7),r(2,"Direcci\xF3n:"),n(),r(3),n()),i&2){let e=a();p(3),g(" ",e.shippingAddress.address," ")}}function Q(i,t){if(i&1&&(o(0,"p",5)(1,"span",7),r(2,"Ciudad:"),n(),r(3),n()),i&2){let e=a();p(3),g(" ",e.shippingAddress.city," ")}}function W(i,t){if(i&1&&(o(0,"p",5)(1,"span",7),r(2,"Estado:"),n(),r(3),n()),i&2){let e=a();p(3),g(" ",e.shippingAddress.state," ")}}function X(i,t){if(i&1&&(o(0,"p",5)(1,"span",7),r(2,"C\xF3digo Postal:"),n(),r(3),n()),i&2){let e=a();p(3),g(" ",e.shippingAddress.postalCode," ")}}function Y(i,t){if(i&1&&(o(0,"p",5)(1,"span",7),r(2,"Pa\xEDs:"),n(),r(3),n()),i&2){let e=a();p(3),g(" ",e.shippingAddress.country," ")}}function ee(i,t){if(i&1&&(o(0,"p",5)(1,"span",7),r(2,"Tel\xE9fono:"),n(),r(3),n()),i&2){let e=a();p(3),g(" ",e.shippingAddress.phone," ")}}function te(i,t){if(i&1){let e=E();o(0,"div",6)(1,"button",8),f("click",function(d){u(e);let c=a();return S(c.onSelectEdit(d))}),r(2," Editar "),n(),o(3,"button",9),f("click",function(d){u(e);let c=a();return S(c.onSelectDelete(d))}),r(4," Eliminar "),n()()}}var y=class i{shippingAddress;isEditable=!1;isSelectable=!1;isSelected=!1;edit=new m;delete=new m;select=new m;onSelectEdit(t){t.stopPropagation(),this.edit.emit(this.shippingAddress)}onSelectDelete(t){t.stopPropagation(),this.delete.emit(this.shippingAddress._id)}onCardClick(){this.isSelectable&&this.select.emit(this.shippingAddress._id)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=A({type:i,selectors:[["app-shipping-methods-card"]],inputs:{shippingAddress:"shippingAddress",isEditable:"isEditable",isSelectable:"isSelectable",isSelected:"isSelected"},outputs:{edit:"edit",delete:"delete",select:"select"},decls:13,vars:17,consts:[[1,"bg-white","rounded-lg","shadow-md","p-4","transition-all","duration-300","relative",3,"click"],[1,"flex","justify-between","items-start","mb-3"],[1,"text-lg","font-semibold","text-gray-800","capitalize"],[1,"bg-blue-100","text-blue-800","text-xs","font-medium","px-2.5","py-0.5","rounded"],[1,"space-y-2"],[1,"text-sm","text-gray-600"],[1,"flex","gap-2","flex-wrap"],[1,"font-medium"],[1,"flex-1","bg-blue-500","hover:bg-blue-600","text-white","text-sm","font-medium","py-2","px-4","rounded","transition-colors","duration-200",3,"click"],[1,"flex-1","bg-red-500","hover:bg-red-600","text-white","text-sm","font-medium","py-2","px-4","rounded","transition-colors","duration-200",3,"click"]],template:function(e,s){e&1&&(o(0,"div",0),f("click",function(){return s.onCardClick()}),o(1,"div",1)(2,"h3",2),r(3),n(),v(4,G,2,0,"span",3),n(),o(5,"div",4),v(6,J,4,1,"p",5)(7,Q,4,1,"p",5)(8,W,4,1,"p",5)(9,X,4,1,"p",5)(10,Y,4,1,"p",5)(11,ee,4,1,"p",5),n(),v(12,te,5,0,"div",6),n()),e&2&&(L("hover:shadow-lg",!0)("cursor-pointer",s.isSelectable)("ring-2",s.isSelected)("ring-blue-500",s.isSelected),p(3),g(" ",s.shippingAddress.addressType.replace("_"," ")," "),p(),h(s.shippingAddress.isDefault?4:-1),p(2),h(s.shippingAddress.address?6:-1),p(),h(s.shippingAddress.city?7:-1),p(),h(s.shippingAddress.state?8:-1),p(),h(s.shippingAddress.postalCode?9:-1),p(),h(s.shippingAddress.country?10:-1),p(),h(s.shippingAddress.phone?11:-1),p(),h(s.isEditable?12:-1))},encapsulation:2})};function ie(i,t){if(i&1){let e=E();o(0,"app-shipping-methods-card",2),f("edit",function(d){u(e);let c=a();return S(c.onEdit(d))})("delete",function(d){u(e);let c=a();return S(c.onDelete(d))})("select",function(d){u(e);let c=a();return S(c.onSelect(d))}),n()}if(i&2){let e=t.$implicit,s=a();j("shippingAddress",e)("isEditable",s.isEditable)("isSelectable",s.isSelectable)("isSelected",s.selectedId===e._id)}}var H=class i{shippingMethods=[];isEditable=!1;isSelectable=!1;selectedId=null;edit=new m;delete=new m;select=new m;onEdit(t){this.edit.emit(t)}onDelete(t){this.delete.emit(t)}onSelect(t){this.select.emit(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=A({type:i,selectors:[["app-shipping-methods-list"]],inputs:{shippingMethods:"shippingMethods",isEditable:"isEditable",isSelectable:"isSelectable",selectedId:"selectedId"},outputs:{edit:"edit",delete:"delete",select:"select"},decls:3,vars:0,consts:[[1,"grid","gap-4"],[3,"shippingAddress","isEditable","isSelectable","isSelected"],[3,"edit","delete","select","shippingAddress","isEditable","isSelectable","isSelected"]],template:function(e,s){e&1&&(o(0,"div",0),k(1,ie,1,4,"app-shipping-methods-card",1,$),n()),e&2&&(p(),V(s.shippingMethods))},dependencies:[y],encapsulation:2})};var se=l.enum(["home","work","other"]),M=l.object({_id:l.string(),user:l.string(),name:l.string().min(2).max(100),address:l.string().min(5).max(200),city:l.string().min(2).max(50).regex(/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/),state:l.string().min(2).max(50).regex(/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/),postalCode:l.string().min(4).max(6).regex(/^\d+$/),country:l.string().min(2).max(50).regex(/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+$/).default("M\xE9xico"),phone:l.string().min(10).max(15).regex(/^[0-9+\-\s()]+$/),isDefault:l.boolean(),addressType:se.default("home")}),Z=l.array(M),Se=M.omit({_id:!0,user:!0}),fe=M.partial().required({_id:!0});var q=class i{constructor(t,e,s){this.http=t;this.store=e;this.toast=s;this.loadShippingAddresses()}baseUrl=`${O.BACK_URL}/shipping-address`;shippingAddressSubject=new w(null);shippingAddressListSubject=new w([]);shippingAddress$=this.shippingAddressSubject.asObservable();shippingAddresses$=this.shippingAddressListSubject.asObservable();getUserId(){let t="";return this.store.select(P).pipe(U(1)).subscribe(e=>t=e??""),t}loadShippingAddresses(){let t=this.getUserId();if(console.log("Loading shipping addresses for user ID:",t),!t){console.log("No user ID found, setting empty array"),this.shippingAddressListSubject.next([]);return}this.getShippingAddressByUser(t).subscribe({next:e=>{console.log("Shipping addresses loaded:",e),this.shippingAddressListSubject.next(e)},error:e=>{console.error("Error loading shipping addresses:",e),this.shippingAddressListSubject.next([])}})}getShippingAddressByUser(t){return this.http.get(`${this.baseUrl}/user/${t}`).pipe(T(e=>{console.log("ss",e);let s=Z.safeParse(e);return s.success?s.data:(console.log(s.error),[])}))}addShippingAddress(t){let e=this.getUserId();if(!e)return x([]);let s={name:t.name,address:t.address,city:t.city,state:t.state,postalCode:t.postalCode,country:t.country,phone:t.phone,isDefault:t.isDefault,addressType:t.addressType};return this.http.post(`${this.baseUrl}`,s).pipe(_(()=>this.getShippingAddressByUser(e)),C(d=>{this.toast.success("Direcci\xF3n agregada correctamente"),this.shippingAddressListSubject.next(d)}))}editShippingAddress(t){let e=this.getUserId();if(!e)return x([]);let c=t,{user:s}=c,d=I(c,["user"]);return this.http.put(`${this.baseUrl}/${t._id}`,d).pipe(_(()=>this.getShippingAddressByUser(e)),C(K=>{this.toast.success("Direcci\xF3n de env\xEDo actualizada"),this.shippingAddressListSubject.next(K)}))}deleteShippingAddress(t){let e=this.getUserId();return e?this.http.delete(`${this.baseUrl}/${t}`).pipe(_(()=>this.getShippingAddressByUser(e)),C(s=>{this.toast.success("Direcci\xF3n de env\xEDo eliminada"),this.shippingAddressListSubject.next(s)})):x([])}static \u0275fac=function(e){return new(e||i)(b(z),b(F),b(B))};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})};export{H as a,q as b};
